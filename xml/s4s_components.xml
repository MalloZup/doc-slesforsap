<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd" [
<!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<chapter id="s4s.components">
 <title>The &sles4sap; Components</title>

 <para>&sles4sap; consists of several components such as &sle; &hasi;,
 the Kernel page-cache limit feature, and an Installation Wizard, which
 are briefly explained in the following sections.
 </para>

 <sect1 id="s4s.comp.hasi">
  <title>&sle; &hasi;</title>

  <para>The &sle; &hasi; infrastructure is part of &sles4sap;.</para>

  <para>
   For more information about &sle; &hasi;, see the &haguide; and the
   Best Practice Guides at <ulink
   url="http://www.suse.com/products/sles-for-sap/resource-library/sap-best-practices.html"/>.
  </para>
</sect1>

 <!-- page cache limit -->
 <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="s4s_configuration.xml"/>


 <sect1 id="s4s.comp.wizard">
  <title>The Installation Wizard</title>

  <para>
   The Installation Wizard offers a guided installation path for both,
   the &sls; operating system and the SAP applications.
  </para>

  <para>Additionally, it is an installation framework for third party
   extension.</para>

  <para>
   The Installation Wizard consists of four parts:
</para>
  <orderedlist>
   <listitem>
    <para>
     Installation of the operating system (&sls;)
</para>
   </listitem>
   <listitem>
    <para>
     SAP Wizard Part 1: Copying all required SAP media to the local
     disk.</para>
   </listitem>
   <listitem>
    <para>
     SAP Wizard Part 2: Collecting all parameters for the actual installation
     by querying the user interactively.</para>
   </listitem>
   <listitem>
    <para>
     SAP Wizard Part 3: Running the SAP Installer.</para>
   </listitem>
  </orderedlist>
  
  <para>
   It is possible to run all these parts mostly separately.  This way, very
   flexible installation scenarios is possible.  Here are some examples:</para>

  <itemizedlist>
   <listitem>
    <para>
Just preparing a machine with the operating system (&sls;) and run the SAP
Wizard later.</para>
   </listitem>
   <listitem>
    <para>
     Just preparing a machine with the operating system (&sls;), copying the
     SAP media, and collecting the SAP installation parameters.</para>
   </listitem>
   <listitem>
    <para>
     You can copy such an installation to other machines, maybe with adjusting
     just a few SAP installation parameters.  Then finally run the SAP
     Installer.</para>
   </listitem>
  </itemizedlist>

<!-- FIXME:

III)
Wir haben in der neuen Version die Partitionierung verändert.
Autoyast hat vorher fixe Rules gemacht.

Nun machen wir eine (fast) fixe Partitionierung nur für das OS
und dann eine "Anwendungsabhänginge" (von Produktauswahl )
Partitionierung die template basierend ist.

Hier der Hinweis auf die SAP-Note mit SWAP
-->

  <!--
        4.3.1 what is it
        4.3.2 further use-cases/sceanrios
	4.3.3 crypto-cd
        sollte im SAP BAiO guide beschrieben sein

        4.3.4 supplement cd
        done (along the Workshop slides)
        4.3.5 partitioner templates
        neues feature -> Peter Varkoly

  -->

  <sect2 id="s4s.comp.wizard.suppl">
   <title>Supplement Media</title>
   <para>
The basic idea of the <quote>Supplement Media</quote> is to enable partners or customers to add own tasks or workflows to the Installation Wizard based installation.
   </para>
   <para>
It is done by a small XML file, which is not different as a part of an &ay; XML file. This file must be called <filename>product.xml</filename>; then it will be included into the workflow.
   </para>
   <para>
This can be used for various types of additions, e.g. adding your own
RPMs, running your own scripts up to setting up a cluster file system or
creating your own dialogs and scripts.
   </para>

   <sect3>
    <title><filename>product.xml</filename></title>

    <para>
The <filename>product.xml</filename> looks like a normal &ay;
XML file, but with some restrictions.
    </para>
    <para>
The restriction are coming from the circumstance that only the parts for the second stage of the installation could be run, because the first stage was executed before.
    </para>
    <para>
Both XML files (<filename>autoyast.xml</filename> and
<filename>product.xml</filename>) will be merged after the media is read
and a <quote>new</quote> &ay; XML file is generated on the fly for the
further workflow.
    </para>
    <para>
     The following areas or sections will be merged:
    </para>
<screen><![CDATA[<general> section
  <ask-list>         (see 2)
  ...
<software> section   (see 3)
  <post-packages>
  ...
<scripts> section
  <chroot-scripts>   (after the package installation, before the first boot)
  <post-scripts>     (during the first boot of the installed system, no
                      services running)
  <init-scripts>     (during the first boot of the installed system, all
                      services up and  running)
  ...]]></screen>
<para>
All other sections will be replaced.
</para>

<para>
 For the details about other customization options, see the SLES &ay;
 Guide, Chapter <quote>4.12. Custom User Scripts</quote>.
</para>
   </sect3>

   <sect3>
    <title>Own &ay; Ask Dialogs</title>
    <para>
For a general overview and the details of the Ask feature of &ay;, see Chapter <quote>4.17.  Ask the User for Values During Installation</quote> of the SLES &ay; Guide.
    </para>
    <para>
For the supplement media you can only use dialogs within the
<literal>cont</literal> stage
(<literal><![CDATA[<stage>cont</stage>]]></literal>), which means they
are executed after the first reboot.
    </para>
    <para>
Your file with the dialogs will be merged with the base &ay; XML file.
    </para>
    <para>
As a best practice, your dialog should have a dialog number and an
element number, best with steps of 10. This helps to include later
additions and also could be used as targets for jumping over a dialog or
element dependent on decisions. We use this too in our base dialogs and
if you provide the right dialog number and element number you can place
you dialog between our base dialogs.
    </para>
    <para>
You can store the answer to a question in a file, to use it in one of
your scripts later.  Be aware that you <emphasis>must</emphasis> use the
prefix <literal>/tmp/ay</literal> for this, because the Installation
Wizard will copy such files from the <filename>/tmp</filename> directory
to the directory where your media data also will be copied.  This is
done because the next supplement media, could have the same dialogs or
same answer file names and would overwrite the values saved here.
    </para>
    <para>
     Here is an example with several options:
    </para>
<screen><![CDATA[<?xml version="1.0"?>
<!DOCTYPE profile>
<profile xmlns="http://www.suse.com/1.0/yast2ns"
         xmlns:config="http://www.suse.com/1.0/configns">
<general>
  <ask-list config:type="list">
      <ask>
          <stage>cont</stage>
          <dialog config:type="integer">20</dialog>
          <element config:type="integer">10</element>
          <question>What is your name?</question>
          <default>Enter your name here</default>
          <help>Please enter you full name within the field</help>
          <file>/tmp/ay_q_my_name</file>
          <script>
             <filename>my_name.sh</filename>
             <rerun_on_error config:type="boolean">true</rerun_on_error>
             <environment config:type="boolean">true</environment>
             <source><![CDATA[
function check_name() {
           local name=$1
           LC_ALL=POSIX
           [ -z "$name" ] && echo "You need to provide a name." && return 1
           return 0
}
check_name "$VAL"
]]>]<![CDATA[]>
             </source>
             <debug config:type="boolean">false</debug>
             <feedback config:type="boolean">true</feedback>
          </script>
      </ask>
  </ask-list>
</general>
</profile>]]></screen>
   </sect3>
   <sect3>
    <title>Install Additional Packages</title>
    <para>
You can also install RPM packages within the
<filename>product.xml</filename> file. For this you could use the
<literal>&lt;post-packages></literal> element for install in stage 2.
    </para>
    <para>
     For more information, see the SLES &ay; Guide, Chapter
     <quote>4.5.6. Installing Packages during Stage 2</quote>.  An
     example looks as follows:
    </para>
<screen><![CDATA[...
<software>
 <post-packages config:type="list">
  <package>yast2-cim</package>
 </post-packages>
</software>
...]]></screen>
   </sect3>
   <sect3>
    <title>Example Directory for the Supplement Media</title>
    <screen># ls
/
|--Product.xml
</screen>
   </sect3>
  </sect2>

  <sect2  id="s4s.comp.clamsap">
   <title>ClamSAP</title>
   <para>
ClamSAP is a new antivirus toolkit integration with the SAP Virus Scan
Interface that improves cross-platform threat detection.</para>

   <para>
ClamSAP is a 'C' shared library to link between ClamAV and the virus scan
interface of SAP (NW-VSI). A SAP application can use the ClamAV engine to scan
for malicious uploads in HTTP uploads for example. If you want use Virus Scan
within SAP applications you can use Virus Scan Interface in SAP (transaction
VSCAN). There is an opensource adapter for the ClamAV engine on <ulink
url="http://freshmeat.net/projects/clamsap/"/>. The library allows an
integration of ClamAV into SAP and works also on Unix where most other products
do not run.</para>

   <para>
ClamAV is an open source (GPL) antivirus engine designed for detecting
Trojans, viruses, malware and other malicious threats. It is the de
facto standard for mail gateway scanning. It provides a high performance
mutli-threaded scanning daemon, command line utilities for on demand
file scanning, and an intelligent tool for automatic signature updates.
For more information, see <ulink url="http://www.clamav.net"/>.</para>
  </sect2>
 </sect1>

</chapter>
