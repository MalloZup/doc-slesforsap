<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="s4s.part">
 <title>Partitioning</title>
 <info/>
 <para>
  <remark>FIXME: "happen" is probably the wrong word. - sknorr, 2016-01-11
  </remark>
  During installation, partitioning will be done in two steps. The first step
  happens while installing the operating system (stage 1, see
  <xref linkend="sec.s4s.inst.wizard.prepauto"/>).
  The second step happens while installing your SAP product (stage 2, see
  <xref linkend="sec.s4s.inst.wizard.sap-product-install"/>).
 </para>
 <sect2 xml:id="sec.s4s.part.inst">
  <title>Stage 1: Partitioning for the Operating System</title>

  <para>
   During stage 1 of the installation (see
   <xref linkend="sec.s4s.inst.wizard.prepauto"/>), partitions for the
   operating system will be created.
  </para>

  <para>
   <remark>Ask varkoly/ke why we are using root_lv and swap_lv here, despite the
   fact that neither of these names is ever mentined in the UI...</remark>
   A logical volume group (LVG) named <literal>system</literal> will be
   created. This LVG contains two logical volumes (LVs) named
   <literal>root_lv</literal> and <literal>swap_lv</literal>. The size of
   <literal>swap_lv</literal> will be calculated according to the SAP
   Note 1984787
   (<link xlink:href="https://service.sap.com/sap/support/notes/1984787"/>).
  </para>
  <para>
   By default, <literal>root_lv</literal> will be set to a maximum of
   60 GB.
  </para>
  <tip>
   <title>Size of the System Volume</title>
   <para>
    Normally, at least 35 GB is required for the system volume. The swap
    space depends on the available main memory (RAM). For more
    information, see <citetitle>SAP Note 1984787</citetitle>
    (<link xlink:href="https://service.sap.com/sap/support/notes/1984787"/>)
   </para>
  </tip>

  <para>
   You can change both, the size of the system volume (<guimenu>Set the
   system volume size in GB</guimenu>) and the size of the swap partition
   (<guimenu>Set the SWAP size in GB</guimenu>). When doing this, mind some
   caveats:
  </para>

  <remark>
   According to varkoly, there is a new partitioning proposal... no home,
   max-60GB Btrfs root, 2GB swap, LVM-based, swap can be resized by SAP
   installer. - sknorr, 2016-01-11
  </remark>

  <remark>
   According to varkoly, Netweaver stuff generally needs 80GB (or more) to
   itself, HANA needs 60GB to itself. - sknorr, 2016-01-11
  </remark>
  <remark>
   I can't actually see the system reserving 1GB for boot. Huh. (Out of 100GB,
   it reserves 99.99GB for the system LVG) - sknorr, 2016-01-12
  </remark>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     1 GB of space will be reserved for the boot partition or UEFI.
     This means that the size of the system volume must be at least 1 GB smaller
     then the physical size of the device.
    </para>
   </listitem>
   <listitem>
    <para>
     Avoid changing the size of the swap partition. Only in the case
     that you are installing HANA, set its size to 2 GB.
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>root_lv</literal> should not be smaller than 5 GB.
    </para>
   </listitem>
  </itemizedlist>

  <note>
   <title>Error Messages</title>
   <para>
    Error messages are only issued, if the size of the system volume (plus 1 GB)
    exceeds the physical size of the device or if the swap partition exceeds
    the size of the system volume.
   </para>
  </note>
 </sect2>
<!-- ============================================================ -->
 <sect2 xml:id="sec.s4s.part.sap">
  <title>Stage 2: Partitioning for the SAP System</title>

  <para>
   After installing the operating system, the partitioning for the SAP system
   will take place. This can be done during stage 2 of the installation
   phase or in the running system.
  </para>

  <para>
   The partitioning for the SAP system is not controlled by
   <filename>autoinst.xml</filename> which is only used for the installation of
   the operating system. The <filename>autoinst.xml</filename> functionality no
   longer exists in the running system. Instead, the following files
   control the partitioning for the SAP system:
  </para>

  <para>
   In <filename>/etc/sap-installation-wizard.xml</filename>, the
   <literal>&lt;partitioning&gt;</literal> tag defines for which SAP
   programs which files for controlling the partitioning are used. These
   files will be taken from
   <filename>/usr/share/YaST2/include/sap-installation-wizard/</filename>.
   If no partitioning is needed (for example, if the installation is based
   on HA or a distributed database is configured), set the
   <literal>&lt;partitioning&gt;</literal> tag to <literal>no</literal>,
   then <filename>base_partitioning.xml</filename> will be used.
  </para>

  <para>
   The files for controlling the partitioning are &ay; control
   files that contain a partitioning section only. There are several
   extensions:
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     If the <literal>&lt;partitioning_defined&gt;</literal> tag is set to
     <literal>true</literal>, the partitioning will be performed without any
     user interaction. This, for example, is preconfigured in files for
     controlling the partitioning of known hardware such as Dell, Fujitsu,
     HP, or IBM Server systems. If the SAP Installation Wizard recognizes
     this hardware, the appropriate file will be selected.
<!--Note-->
     This applies for SAP Business One/HANA only!
    </para>
   </listitem>
   <listitem>
    <para>
     For every partition, you can specify the
     <literal>&lt;size_min&gt;</literal> tag. The size value can be given as
     a string in the format of
     <literal><replaceable>RAM</replaceable>*<replaceable>N</replaceable></literal>.
     This way you can specify how large the partition should be minimally
     (<replaceable>N</replaceable> times the size of the available
     memory (<replaceable>RAM</replaceable>)).
    </para>
   </listitem>
  </itemizedlist>

  <para>
   If you need something different (for example, for TREX), proceed as follows:
  </para>

  <procedure>
   <step>
    <para>
     In
     <filename>/usr/share/YaST2/include/sap-installation-wizard/</filename>,
     create a new file for controlling the partitioning (for example,
     <filename>TREX_partitioning.xml</filename>). You can base the new file
     on <filename>base_partitioning.xml</filename> and change it according
     to your needs.
    </para>
   </step>
   <step>
    <para>
     In <filename>/etc/sap-installation-wizard.xml</filename>, at the
     <literal>TREX</literal> following tag insert:
    </para>
<screen><![CDATA[<partitioning>TREX_partitioning.xml</partitioning>]]></screen>
   </step>
  </procedure>

  <warning>
   <title>Do Not Edit <filename>base_partitioning.xml</filename></title>
   <para>
    Do not edit <filename>base_partitioning.xml</filename> directly. With
    the next update, this file will be overridden.
   </para>
  </warning>

  <para>
   For more information on partitioning with &ay;, see the
   <emphasis>Chapter 4.4 <quote>Partitioning</quote></emphasis> of the
   <emphasis>&ay; Guide</emphasis>.
  </para>
 </sect2>
</sect1>
