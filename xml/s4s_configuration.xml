<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="cha.s4s.configure">
 <title>Configuring &sles4sap;</title>

 <para></para>

 <sect1 xml:id="sec.s4s.configure.page-cache">
  <title>Kernel: Page-Cache Limit</title>
  <variablelist>
   <varlistentry>
    <term>Problem</term>
    <listitem>
     <para>
      The kernel swaps out rarely accessed memory pages to use
      freed memory pages as cache to speed up file system operations, for
      instance during backup operations.
     </para>
     <para>
      Some SAP solutions use large amounts of memory for accelerated access
      to business data. Parts of this memory are rarely accessed. When a
      user request then needs to access paged out memory, the response time
      is poor. It is even worse when an SAP solution running on Java incurs
      a Java garbage collection. The system starts heavy page-in (disc I/O)
      activity and has a poor response time for an extended period of time.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Solution</term>
    <listitem>
     <para>
      A kernel tune option has been introduced that allows the system
      administrator to limit the amount of page cache that the kernel uses
      when there is competition between application memory and page-cache.
      This option tells the kernel that when the page cache is filled to the
      configured limit, application memory is more important and should thus
      not be paged out. No pages will be paged out if the memory footprint
      of the workload plus the configured page-cache limit do not exceed the
      amount of physical RAM in the system.
     </para>
     <para>
      These kernel options are available for configuration:
     </para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para>
        <literal>vm.pagecache_limit_mb</literal>
        (<filename>/proc/sys/vm/pagecache_limit_mb</filename>)
       </para>
      </listitem>
      <listitem>
       <para>
        <literal>vm.pagecache_limit_ignore_dirty</literal>
        (<filename>/proc/sys/vm/pagecache_limit_ignore_dirty</filename>)
       </para>
      </listitem>
     </itemizedlist>
     <para>
      For permanent use, set them in <filename>/etc/sysctl.conf</filename>,
      for example:
     </para>
<screen>vm.pagecache_limit_mb = 1024
vm.pagecache_limit_ignore_dirty = 0</screen>
     <para>
      For background information, see <citetitle>SAP Note 1557506: Linux Paging
      Improvements</citetitle>
      (<link xlink:href="https://service.sap.com/sap/support/notes/1557506"/>).
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>

<!-- ==================================================================== -->

 <sect1 xml:id="sec.s4s.configure.firewall">
  <title>Firewall Configuration</title>

  <para>
   By default, the installation workflow of &sles4sap; enables
   &susefirewall;. The firewall needs to
   manually be configured to allow network access for the following:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     SAP application
    </para>
   </listitem>
   <listitem>
    <para>
     Database (for &hana;, see the note below,
     otherwise see the documentation of your database vendor)
    </para>
   </listitem>
  </itemizedlist>
  <para>
   Additionally, open the ports 1128 (TCP) and 1129 (UDP).
  </para>

  <remark>
   Would be good to have the instances where each of the opened port ranges is
   needed spelled out OR otherwise, we could just refer to SAP documentation
   for the relevant product and put a description of how to open ports here.
   The current thing we have here is the general specific and only helpful if
   you want overly many holes in your wall, it seems. - sknorr, 2016-01-22
  </remark>
  <para>
   SAP applications require many open ports and port ranges in the firewall.
   The exact numbers depend on the selected instances, for example:
  </para>
  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     3200-3399,
    </para>
   </listitem>
   <listitem>
    <para>
     3600,
    </para>
   </listitem>
   <listitem>
    <para>
     4700-4899,
    </para>
   </listitem>
   <listitem>
    <para>
     7200-7299,
    </para>
   </listitem>
   <listitem>
    <para>
     50000-59999.
    </para>
   </listitem>
  </itemizedlist>

  <note>
   <title>Firewall Rules for &hana;</title>

   <para>
    For &hana;, you do not need to set up firewall rules manually.
    Instead, they can be installed from the package
    <systemitem>HANA-Firewall</systemitem>.
   </para>
  </note>
 </sect1>

 <sect1 xml:id="s4s.configure.log">
  <title>Important Log Files</title>

  <remark>
   This section does not really fit the configuration theme. Any better place
   for it? - sknorr, 2016-01-22
  </remark>

  <para>
   The most important files for this product are:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     The &sapwiz; is a &yast; module. You can find its log entries in
     <filename>/var/log/YaST/y2log</filename>.
    </para>
   </listitem>
   <listitem>
    <para>
     All SAP knowledge is bundled in a library. You can find its log entries in
     <filename>/var/log/SAPmedia.log</filename>.
    </para>
   </listitem>
   <listitem>
    <para>
     You can find log files related to auto-installation in
     <filename>/var/adm/autoinstall/logs</filename>.
    </para>
   </listitem>
  </itemizedlist>
 </sect1>

</chapter>
